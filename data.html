<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FPL Player & Team Database</title>
    <style>
      :root {
        --bg-dark: #121826;
        --card-bg: #1f2937;
        --accent-blue: #4dafff;
        --accent-green: #5fffd0;
        --text-light: #fff;
        --shadow-dark: rgba(0, 0, 0, 0.4);
      }

      body {
        margin: 0;
        font-family: "Segoe UI", sans-serif;
        background: linear-gradient(to right, #212121, #210494, #212121);
        color: var(--text-light);
        scroll-behavior: smooth;
        background-image: url("LMF Nsky.png");
      }

      header {
        padding: 5px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 100;
        border-bottom: 2px solid var(--accent-blue);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        flex-wrap: wrap;
        gap: 10px;
        transition: all 0.3s ease;
        height: 125px;
        background-image: url("LMF Nsky.png");
        background-size: cover;
        background-position: bottom;
        background-repeat: no-repeat;
      }

      .section-heading {
        text-align: center;
        font-size: 60px;
        font-weight: bold;
        margin: 30px 0 10px;
        color: #ffffff;
        text-shadow: 5px 0 0 #212121;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        font-size: 22px;
        font-weight: 900;
        color: var(--accent-blue);
        text-shadow: 0 0 8px rgba(77, 175, 255, 0.7);
        transition: transform 0.3s ease, text-shadow 0.3s ease;
      }

      .logo:hover {
        transform: scale(1.08);
        text-shadow: 0 0 15px rgba(93, 255, 208, 1),
          0 0 30px rgba(77, 175, 255, 1);
      }

      .logo-icon {
        width: 120px;
        height: 120px;
        filter: drop-shadow(0 0 10px rgba(93, 255, 208, 0.8))
          drop-shadow(0 0 20px rgba(77, 175, 255, 0.6));
        transition: transform 0.4s ease, filter 0.4s ease;
      }

      .logo:hover .logo-icon {
        transform: rotate(-5deg) scale(1.1);
        filter: drop-shadow(0 0 15px rgba(93, 255, 208, 1))
          drop-shadow(0 0 30px rgba(77, 175, 255, 1));
      }

      .nav-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: flex-end;
        align-items: center;
      }

      .nav-buttons button {
        padding: 6px 14px;
        border-radius: 8px;
        border: 3px solid black;
        background: #210494;
        color: #ffffff;
        font-weight: bold;
        cursor: pointer;
        font-size: 13px;
        transition: transform 0.3s ease, box-shadow 0.3s ease,
          background 0.3s ease, color 0.3s ease;
      }

      .nav-buttons button:hover {
        transform: scale(1.05);
        box-shadow: 0 0 15px rgba(77, 175, 255, 0.7);
        background: #ffffff;
        color: #000;
      }

      .team-select-container,
      .filter-container {
        display: flex;
        justify-content: center;
        margin: 10px 0;
        gap: 10px;
      }

      .filter-container {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 10px;
        padding: 5px;
      }

      .filter-container button {
        padding: 6px 12px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        background: #210494;
        color: #ffffff;
        font-weight: bold;
        transition: transform 0.2s;
        border: 3px solid black;
      }

      .filter-container button:hover {
        transform: scale(1.05);
        box-shadow: 0 0 15px rgba(77, 175, 255, 0.7);
        background: #ffffff;
        color: #000;
      }

      main {
        padding: 10px 20px;
      }

      .team-card {
        background: var(--card-bg);
        border-radius: 12px;
        margin-bottom: 16px;
        padding: 10px;
        box-shadow: 0 6px 15px var(--shadow-dark);
      }

      .team-header {
        font-weight: bold;
        font-size: 16px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px;
        background: linear-gradient(to right, #212121, #303f9f);
        border-radius: 8px;
      }

      .table-wrapper {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      table {
        width: 100%;
        min-width: 850px;
        border-collapse: collapse;
        color: #fff;
      }

      th,
      td {
        padding: 6px 10px;
        text-align: center;
        font-size: 12px;
        white-space: nowrap;
      }

      th {
        font-weight: bold;
        background: rgba(77, 175, 255, 0.3);
        border-radius: 6px;
        position: sticky;
        top: 0;
        z-index: 2;
      }

      tr.player:nth-child(even) {
        background: rgba(255, 255, 255, 0.05);
      }
      tr.player:hover {
        background: rgba(77, 175, 255, 0.2);
      }

      .fav-star {
        cursor: pointer;
        color: #888;
      }
      .fav-star.active {
        color: gold;
        text-shadow: 0 0 4px #000;
      }

      footer {
        text-align: center;
        padding: 15px;
        background: linear-gradient(to right, #212121, #210494, #212121);
        border-top: 1px solid var(--accent-blue);
        font-size: 12px;
      }

      .hero-video {
        width: 100%;
        height: 55vh;
        overflow: hidden;
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
      }

      .hero-video video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: -1;
      }

      .select-wrapper {
        position: relative;
        width: 60%;
        max-width: 400px;
        margin: 20px auto;
      }

      #team-select {
        width: 100%;
        padding: 14px 40px 14px 20px;
        font-size: 18px;
        border-radius: 30px;
        border: 2px solid var(--accent-blue);
        background-color: var(--card-bg);
        color: var(--text-light);
        outline: none;
        cursor: pointer;
        box-shadow: 0 6px 15px var(--shadow-dark);
        transition: all 0.3s ease;
        appearance: none;
      }

      #team-select:hover,
      #team-select:focus {
        border-color: var(--accent-green);
        box-shadow: 0 8px 20px rgba(93, 255, 208, 0.5);
      }

      .select-wrapper::after {
        content: "▼";
        position: absolute;
        top: 50%;
        right: 16px;
        transform: translateY(-50%);
        pointer-events: none;
        color: var(--accent-blue);
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <header>
      <h1 class="logo" onclick="location.reload()">
        <img class="logo-icon" src="LMF Gold.png" alt="Let Me Fantasy Logo" />
      </h1>

      <div class="nav-buttons">
        <button onclick="window.location.href='fixture.html'">Fixtures</button>
        <button onclick="window.location.href='FDR.html'">FDR</button>
        <button onclick="window.location.href='top-team.html'">Top Team</button>
        <button onclick="window.location.href='index.html'">Dashboard</button>
      </div>
    </header>

    <section class="hero-video">
      <video autoplay muted loop playsinline>
        <source src="LMF Football.mp4" type="video/mp4" />
      </video>
    </section>

    <h2 class="section-heading">Player stats</h2>

    <div class="team-select-container">
      <div class="select-wrapper">
        <select id="team-select">
          <option value="">Select a team...</option>
        </select>
      </div>
    </div>

    <div class="filter-container">
      <button data-sort="total_points">Sort by Points</button>
      <button data-sort="goals_scored">Sort by Goals</button>
      <button data-sort="assists">Sort by Assists</button>
      <button data-sort="minutes">Sort by Minutes</button>
      <button data-sort="saves">Sort by Saves</button>
      <button id="show-favs">Show Favourites</button>
    </div>

    <main id="teams-container">Loading data...</main>

    <footer>OFFSIDE LINE</footer>

    <script>
      const API_BASE =
        "https://corsproxy.io/?https://fantasy.premierleague.com/api";
      let bootstrapData;
      let currentSort = "total_points";
      const favKey = "fplFavs";
      let favourites = JSON.parse(localStorage.getItem(favKey) || "[]");
      let showOnlyFavs = false;

      async function loadData() {
        try {
          bootstrapData = await fetch(API_BASE + "/bootstrap-static/").then(
            (r) => r.json()
          );
        } catch (e) {
          document.getElementById("teams-container").innerHTML =
            "Error loading data.";
          return;
        }

        const teamSelect = document.getElementById("team-select");
        bootstrapData.teams
          .sort((a, b) => a.name.localeCompare(b.name))
          .forEach((team) => {
            let opt = document.createElement("option");
            opt.value = team.id;
            opt.textContent = team.name;
            teamSelect.appendChild(opt);
          });

        teamSelect.addEventListener("change", () =>
          renderTeam(teamSelect.value)
        );
      }

      function renderTeam(teamId) {
        const container = document.getElementById("teams-container");
        container.innerHTML = "";

        let teamPlayers = [];
        let teamsToRender = [];

        if (teamId) {
          let team = bootstrapData.teams.find((t) => t.id == teamId);
          teamsToRender = [team];
          teamPlayers = bootstrapData.elements.filter((p) => p.team == team.id);
        } else if (showOnlyFavs) {
          teamsToRender = bootstrapData.teams;
          teamPlayers = bootstrapData.elements.filter((p) =>
            favourites.includes(p.id)
          );
        } else {
          container.innerHTML =
            "Please select a team or click 'Show Favourites'.";
          return;
        }

        teamsToRender.forEach((team) => {
          let players = teamPlayers;
          if (!teamId) players = teamPlayers.filter((p) => p.team == team.id);
          if (players.length === 0) return;

          players.sort((a, b) => b[currentSort] - a[currentSort]);

          const card = document.createElement("div");
          card.className = "team-card";

          const header = document.createElement("div");
          header.className = "team-header";
          header.textContent = `${team.name} (${players.length} players)`;
          card.appendChild(header);

          const wrapper = document.createElement("div");
          wrapper.className = "table-wrapper";

          const table = document.createElement("table");
          table.innerHTML = `<thead>
            <tr>
              <th>Fav</th><th>Name</th><th>Pos</th><th>Points</th><th>Cost</th>
              <th>%Sel</th><th>Minutes</th><th>Form</th>
              <th>Goals</th><th>Assists</th><th>CS</th>
              <th>GC</th><th>Saves</th><th>OG</th><th>Pen Saved</th>
              <th>YC</th><th>RC</th>
            </tr>
          </thead>
          <tbody>
            ${players
              .map((p) => {
                const active = favourites.includes(p.id) ? "active" : "";
                return `
              <tr class="player" data-id="${p.id}">
                <td><span class="fav-star ${active}">★</span></td>
                <td>${p.web_name}</td>
                <td>${posName(p.element_type)}</td>
                <td>${p.total_points}</td>
                <td>£${(p.now_cost / 10).toFixed(1)}m</td>
                <td>${p.selected_by_percent}</td>
                <td>${p.minutes}</td>
                <td>${parseFloat(p.form).toFixed(2)}</td>
                <td>${p.goals_scored}</td>
                <td>${p.assists}</td>
                <td>${p.clean_sheets}</td>
                <td>${p.goals_conceded}</td>
                <td>${p.saves}</td>
                <td>${p.own_goals}</td>
                <td>${p.penalties_saved}</td>
                <td>${p.yellow_cards}</td>
                <td>${p.red_cards}</td>
              </tr>`;
              })
              .join("")}
          </tbody>`;

          wrapper.appendChild(table);
          card.appendChild(wrapper);
          container.appendChild(card);
        });

        container.querySelectorAll(".fav-star").forEach((el) =>
          el.addEventListener("click", () => {
            const row = el.closest("tr");
            const pid = Number(row.dataset.id);
            if (favourites.includes(pid)) {
              favourites.splice(favourites.indexOf(pid), 1);
              el.classList.remove("active");
            } else {
              favourites.push(pid);
              el.classList.add("active");
            }
            localStorage.setItem(favKey, JSON.stringify(favourites));
          })
        );
      }

      function posName(id) {
        return { 1: "GK", 2: "DEF", 3: "MID", 4: "FWD" }[id] || "UNK";
      }

      document
        .querySelectorAll(".filter-container button[data-sort]")
        .forEach((btn) => {
          btn.addEventListener("click", () => {
            currentSort = btn.dataset.sort;
            renderTeam(document.getElementById("team-select").value);
          });
        });

      document.getElementById("show-favs").addEventListener("click", () => {
        showOnlyFavs = !showOnlyFavs;
        document
          .getElementById("team-select")
          .dispatchEvent(new Event("change"));
        document.getElementById("show-favs").textContent = showOnlyFavs
          ? "Show All"
          : "Show Favourites";
      });

      loadData();
    </script>
  </body>
</html>
