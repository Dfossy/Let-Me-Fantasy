<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FPL Fixture Heatmap</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-dark: #0f172a;
        --card-bg: #1f2937;
        --text-light: #e5e7eb;
        --accent: #3b82f6;
        --accent-blue: #4dafff;
        --very-easy: #83faaf; /* green-lighter */
        --easy: #0a7431; /* green */
        --medium: #facc15; /* yellow */
        --hard: #f97316; /* orange/red */
        --very-hard: #ef4444; /* red */
      }

      body {
        font-family: "Inter", sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(to right, #212121, #210494, #212121);
        color: var(--text-light);
      }

      header {
        padding: 5px 20px;
        background: linear-gradient(
          to right,
          #4169e1,
          #8a2be2,
          #ff6fb5,
          #8a2be2,
          #4169e1
        );
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky; /* ✅ keep sticky */
        top: 0;
        z-index: 100;
        border-bottom: 2px solid var(--accent-blue);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        flex-wrap: wrap;
        gap: 10px;
        transition: all 0.3s ease;
        height: 125px;
        background-image: url("LMF Nsky.png");
        background-size: cover;
        background-position: bottom;
        background-repeat: no-repeat;
      }

      .section-heading {
        text-align: center;
        font-size: 60px;
        font-weight: bold;
        margin: 30px 0 10px;
        color: #ffffff;
        text-shadow: 5px 0 0 #212121;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        font-size: 22px;
        font-weight: 900;
        color: var(--accent-blue);
        text-shadow: 0 0 8px rgba(77, 175, 255, 0.7);
        transition: transform 0.3s ease, text-shadow 0.3s ease;
      }

      .logo:hover {
        transform: scale(1.08);
        text-shadow: 0 0 15px rgba(93, 255, 208, 1),
          0 0 30px rgba(77, 175, 255, 1);
      }

      .logo-icon {
        width: 120px;
        height: 120px;
        filter: drop-shadow(0 0 10px rgba(93, 255, 208, 0.8))
          drop-shadow(0 0 20px rgba(77, 175, 255, 0.6));
        transition: transform 0.4s ease, filter 0.4s ease;
      }

      .logo:hover .logo-icon {
        transform: rotate(-5deg) scale(1.1);
        filter: drop-shadow(0 0 15px rgba(93, 255, 208, 1))
          drop-shadow(0 0 30px rgba(77, 175, 255, 1));
      }

      .logo-text {
        background: #065084;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .nav-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: flex-end;
        align-items: center;
      }

      .nav-buttons button {
        padding: 6px 14px;
        border-radius: 8px;
        border: 3px solid black;
        background: #210494;
        color: #ffffff;
        font-weight: bold;
        cursor: pointer;
        font-size: 13px;
        transition: transform 0.3s ease, box-shadow 0.3s ease,
          background 0.3s ease, color 0.3s ease;
      }

      .nav-buttons button:hover {
        transform: scale(1.05);
        box-shadow: 0 0 15px rgba(77, 175, 255, 0.7);
        background: #ffffff;
        color: #000;
      }

      main {
        padding: 2rem;
        max-width: 1400px;
        margin: 0 auto;
      }

      .loading {
        text-align: center;
        font-size: 1.2rem;
        margin-top: 2rem;
        color: var(--accent);
      }

      .table-container {
        overflow-x: auto;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        min-width: 1200px;
      }

      th,
      td {
        padding: 0.5rem 0.8rem;
        text-align: center;
        font-size: 0.9rem;
        white-space: nowrap;
        border-bottom: 1px solid #2a3b4d;
      }

      th {
        background: var(--card-bg);
        color: var(--accent);
        position: sticky;
        top: 0;
        z-index: 2;
      }

      td:first-child,
      th:first-child {
        position: sticky;
        left: 0;
        background: var(--card-bg);
        font-weight: 600;
        z-index: 3;
        text-align: left;
        padding-left: 1rem;
      }

      td {
        transition: transform 0.15s;
      }

      td:hover {
        transform: scale(1.05);
      }

      .very-easy {
        background: var(--very-easy);
        color: #111;
      }
      .easy {
        background: var(--easy);
        color: #111;
      }
      .medium {
        background: var(--medium);
        color: #111;
      }
      .hard {
        background: var(--hard);
        color: #111;
      }
      .very-hard {
        background: var(--very-hard);
        color: #111;
      }

      .played {
        opacity: 0.9;
        font-weight: 600;
      }

      /* Hero */
      .hero-image,
      .hero-video {
        width: 100%;
        overflow: hidden;
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
        color: white;
        font-weight: 600;
        text-shadow: 0 3px 8px #000;
      }
      .hero-image {
        height: 30vh;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
      }
      .hero-image img {
        width: 100%;
        height: auto;
        display: block;
        border-bottom: 2px solid var(--accent-blue);
      }
      .hero-video {
        height: 55vh;
      }
      .hero-video video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: -1;
      }
      .hero-video .overlay-text {
        position: relative;
        z-index: 1;
        padding: 0 10px;
      }

      /* Grid Layout */
      .content-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      /* Responsive */
      @media (max-width: 768px) {
        header {
          flex-direction: column;
          align-items: center;
          height: auto;
          padding: 8px 10px;
        }

        .logo-icon {
          width: 80px;
          height: 80px;
        }

        .nav-buttons {
          justify-content: center;
          overflow-x: auto;
          padding-bottom: 6px;
        }

        .nav-buttons button {
          font-size: 12px;
          padding: 6px 10px;
          flex: 0 0 auto;
        }

        .hero-video,
        .hero-image {
          height: 60vh;
        }

        .fixture-card {
          flex-direction: column;
          text-align: center;
          font-size: 14px;
        }

        table {
          display: block;
          overflow-x: auto;
          font-size: 12px;
        }

        .content-grid {
          display: flex !important;
          flex-direction: column !important;
          gap: 20px;
        }

        .content-grid > .card {
          width: 95% !important;
        }
      }

      @media (max-width: 480px) {
        .logo {
          font-size: 14px;
          gap: 4px;
          margin-top: -5px;
        }
        .logo-icon {
          width: 70px;
          height: 70px;
        }
        .header-title {
          font-size: 32px;
          top: 35%;
        }
        .nav-buttons button {
          font-size: 11px;
          padding: 5px 8px;
        }
        .hero-video,
        .hero-image {
          height: 28vh;
          font-size: 0.9rem;
        }
        .fixture-card {
          font-size: 12px;
          padding: 6px;
        }
        .team-header {
          font-size: 11px;
          padding: 6px;
        }
        .search-container input {
          width: 95%;
          font-size: 11px;
        }
        footer {
          font-size: 9px;
          padding: 8px;
        }
        .top-scorer {
          min-width: 70px;
          font-size: 11px;
        }
        .content-grid {
          grid-template-columns: 1fr !important;
        }
        .content-grid > .card {
          width: 100%;
        }
      }

      /* Smooth horizontal scrolling on iOS */
      #players-grid table,
      .top-scorers-row {
        -webkit-overflow-scrolling: touch;
      }

      #players-grid table,
      .top-scorers-row {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      footer {
        text-align: center;
        font-size: 12px;
        color: #fff;
        padding: 15px;
        background: linear-gradient(to right, #212121, #210494, #212121);
        border-top: 1px solid var(--accent-blue);
      }
      .legend {
        margin: 0.5rem 0 1.5rem;
        display: flex;
        justify-content: center;
        gap: 0.8rem;
        flex-wrap: wrap; /
      }

      .legend-item {
        padding: 0.35rem 0.7rem;
        border-radius: 4px;
        font-weight: 600;
        font-size: 0.85rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);

      }
    </style>
  </head>
  <body>
    <header>
      <h1 class="logo" onclick="refreshData()">
        <img class="logo-icon" src="LMF Gold.png" alt="Let Me Fantasy Logo" />
      </h1>

      <div class="nav-buttons">
        <button onclick="window.location.href='FDR.html'">FDR</button>
        <button onclick="window.location.href='data.html'">
          Players by Team
        </button>
        <button onclick="window.location.href='top-team.html'">Top Team</button>
        <button onclick="window.location.href='index.html'">Dashboard</button>
      </div>
    </header>

    <section class="hero-video">
      <video autoplay muted loop playsinline>
        <source src="LMF Football.mp4" type="video/mp4" />
        Your browser does not support the video tag.
      </video>
    </section>
    <h2 class="section-heading">Fixtures</h2>
    <div class="legend">
      <span class="legend-item very-easy">1 – Very Easy</span>
      <span class="legend-item easy">2 – Easy</span>
      <span class="legend-item medium">3 – Medium</span>
      <span class="legend-item hard">4 – Hard</span>
      <span class="legend-item very-hard">5 – Very Hard</span>
    </div>

    <main>
      <div id="loading" class="loading">Loading data...</div>
      <div class="table-container">
        <table id="heatmap"></table>
      </div>
    </main>
    <section class="hero-image">
      <img src="LMF Stars.png" alt="Fantasy Banner" />
    </section>

    <footer>OFFSIDE LINE</footer>

    <script>
      const heatmap = document.getElementById("heatmap");
      const loadingDiv = document.getElementById("loading");
      const corsProxy = "https://corsproxy.io/?";

      async function fetchJSON(url) {
        const res = await fetch(corsProxy + encodeURIComponent(url));
        return await res.json();
      }

      function getDifficultyClass(diff) {
        // FPL API gives 1–5, so map directly
        switch (diff) {
          case 1:
            return "very-easy";
          case 2:
            return "easy";
          case 3:
            return "medium";
          case 4:
            return "hard";
          case 5:
            return "very-hard";
          default:
            return ""; // unknown difficulty
        }
      }

      async function buildHeatmap() {
        loadingDiv.style.display = "block";
        heatmap.innerHTML = "";
        try {
          const bootstrap = await fetchJSON(
            "https://fantasy.premierleague.com/api/bootstrap-static/"
          );
          const fixtures = await fetchJSON(
            "https://fantasy.premierleague.com/api/fixtures/"
          );
          const teams = bootstrap.teams;

          // Table header
          const headerRow = document.createElement("tr");
          const thTeam = document.createElement("th");
          thTeam.textContent = "Team";
          headerRow.appendChild(thTeam);
          for (let gw = 1; gw <= 38; gw++) {
            const th = document.createElement("th");
            th.textContent = `GW${gw}`;
            headerRow.appendChild(th);
          }
          heatmap.appendChild(headerRow);

          // Table rows
          teams.forEach((team) => {
            const row = document.createElement("tr");
            const teamCell = document.createElement("td");
            teamCell.textContent = team.name;
            row.appendChild(teamCell);

            for (let gw = 1; gw <= 38; gw++) {
              const cell = document.createElement("td");
              const fixture = fixtures.find(
                (f) =>
                  f.event === gw &&
                  (f.team_h === team.id || f.team_a === team.id)
              );
              if (fixture) {
                const isHome = fixture.team_h === team.id;
                const opponent = teams.find(
                  (t) => t.id === (isHome ? fixture.team_a : fixture.team_h)
                );
                const diff = isHome
                  ? fixture.team_h_difficulty
                  : fixture.team_a_difficulty;
                const difficultyClass = getDifficultyClass(diff);
                cell.className = difficultyClass;

                if (fixture.finished) {
                  const score = `${fixture.team_h_score}-${fixture.team_a_score}`;
                  const isWinner =
                    (isHome && fixture.team_h_score > fixture.team_a_score) ||
                    (!isHome && fixture.team_a_score > fixture.team_h_score);
                  const isDraw = fixture.team_h_score === fixture.team_a_score;
                  let displayText = `${
                    opponent.short_name || opponent.name
                  } ${score}`;

                  if (!isDraw) {
                    displayText += isWinner ? " ✔" : " ✖";
                  } else {
                    displayText += " ⚪";
                  }

                  cell.textContent = displayText;
                  cell.classList.add("played");
                } else {
                  cell.textContent = opponent.short_name || opponent.name;
                }
              }
              row.appendChild(cell);
            }
            heatmap.appendChild(row);
          });
        } catch (err) {
          console.error(err);
          heatmap.innerHTML =
            "<tr><td colspan='39' style='color:red;'>Failed to load data. Try refreshing.</td></tr>";
        } finally {
          loadingDiv.style.display = "none";
        }
      }

      // Auto-update every 5 minutes
      buildHeatmap();
      setInterval(buildHeatmap, 300000);
    </script>
  </body>
</html>
